<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>geo_shape(地理形状)数据类型 | ElasticSearch 7.7 权威指南中文版</title>
	<meta name="keywords" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <meta name="description" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="../static/styles.css" />
	<script>
	var _link = 'geo-shape.html';
    </script>
</head>
<body>
<div class="main-container">
    <section id="content">
        <div class="content-wrapper">
            <section id="guide" lang="zh_cn">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                            <div style="color:gray; word-break: break-all; font-size:12px;">原英文版地址: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.7/geo-shape.html" rel="nofollow" target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/7.7/geo-shape.html</a>, 原文档版权归 www.elastic.co 所有<br/>本地英文版地址: <a href="../en/geo-shape.html" rel="nofollow" target="_blank">../en/geo-shape.html</a></div>
                        <!-- start body -->
                  <div class="page_header">
<strong>重要</strong>: 此版本不会发布额外的bug修复或文档更新。最新信息请参考 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" rel="nofollow">当前版本文档</a>。
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch 权威指南 [7.7]</a></span>
»
<span class="breadcrumb-link"><a href="mapping.html">映射</a></span>
»
<span class="breadcrumb-link"><a href="mapping-types.html">字段数据类型</a></span>
»
<span class="breadcrumb-node">geo_shape(地理形状)数据类型</span>
</div>
<div class="navheader">
<span class="prev">
<a href="geo-point.html">« geo_point(地理坐标点)数据类型</a>
</span>
<span class="next">
<a href2="ip.html">IP datatype »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title">
<a id="geo-shape"></a>geo_shape(地理形状)数据类型
</h2>
</div></div></div>

<p>
<code class="literal">geo_shape</code>数据类型便于索引和搜索任意地理形状，如矩形和多边形。

当被索引的数据或被执行的查询包含形状而不仅仅是坐标点时，应该使用它。
</p>
<p>可以使用<a class="xref" href="query-dsl-geo-shape-query.html" title="Geo-shape query">geo_shape查询</a>来查询使用此类型的文档。</p>
<h4>
<a id="geo-shape-mapping-options"></a>映射之选项
</h4>
<p>
geo_shape 映射将 geo_json 几何对象映射到 geo_shape 类型。

要启用它，用户必须显式地将字段映射为 geo_shape 类型。
</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3">
</colgroup>
<thead>
<tr>
<th align="left" valign="top">选项</th>
<th align="left" valign="top">描述</th>
<th align="left" valign="top">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">tree</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
要使用的PrefixTree实现的名称：实现 GeohashPrefixTree 的是<code class="literal">geohash</code>，实现 QuadPrefixTree 的是<code class="literal">quadtree</code>。

注意：此参数仅与<code class="literal">term</code>(词项) 和 <code class="literal">recursive</code>(递归) 策略相关。
</p></td>
<td align="left" valign="top"><p><code class="literal">quadtree</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">precision</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
可以使用此参数代替<code class="literal">tree_levels</code>来为<code class="literal">tree_levels</code>参数设置适当的值。

该值指定了所需的精度，Elasticsearch 将计算最佳的 tree_levels 值来满足该精度。

该值应当是后面跟可选距离单位的数字。

有效的距离单位包括：<code class="literal">in</code>、<code class="literal">inch</code>, <code class="literal">yd</code>、<code class="literal">yard</code>、<code class="literal">mi</code>、<code class="literal">miles</code>、<code class="literal">km</code>、<code class="literal">kilometers</code>、<code class="literal">m</code>、<code class="literal">meters</code>、<code class="literal">cm</code>、<code class="literal">centimeters</code>、<code class="literal">mm</code>、<code class="literal">millimeters</code>。

注意：此参数仅与<code class="literal">term</code>(词项) 和 <code class="literal">recursive</code>(递归) 策略相关。
</p>
</td>
<td align="left" valign="top"><p><code class="literal">50m</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">tree_levels</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
PrefixTree 可以使用的最大层数。

这可以用来控制形状表示的精度，从而控制索引的词项的数量。

默认为所选的 PrefixTree 实现的默认值。

由于此参数需要对底层实现有一定程度的了解，因此用户可以使用<code class="literal">precision</code>参数代替之。

然而，Elasticsearch只在内部使用 tree_levels 参数，即使你使用了参数<code class="literal">precision</code>，这也是通过映射API返回的。

注意：此参数仅与<code class="literal">term</code>(词项) 和 <code class="literal">recursive</code>(递归) 策略相关。
</p></td>
<td align="left" valign="top"><p>various</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">strategy</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
参数strategy定义了在编制索引和搜索时如何表示形状的方法。

它还会影响可用的功能，因此建议让 Elasticsearch 自动设置该参数。

有两种可用的参数：<code class="literal">recursive</code>和<code class="literal">term</code>。

recursive 和 term 策略已废弃，在未来的版本中将会删除。

虽然它们仍然可用，但 term 策略仅支持 point(坐标点) 类型(参数<code class="literal">points_only</code>将自动设置为 true)，而 recursive 策略支持所有 shape(形状) 类型。

(重要提示：有关这些策略的更多详细信息，请参考<a class="xref" href="geo-shape.html#prefix-trees" title="前缀树">前缀树</a>)
</p></td>
<td align="left" valign="top"><p><code class="literal">recursive</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">distance_error_pct</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
用作 PrefixTree 的暗示，告诉它应该有多精确。

默认值为 0.025 (2.5%)，支持的最大值为 0.5。

性能说明：如果明确申明了<code class="literal">precision</code>或<code class="literal">tree_level</code>定义，该值将默认为 0。

这保证了映射中定义的空间精度。

这可能导致低误差的高分辨率形状占用大量内存(例如，1m 精度的大形状误差小于 0.001)。

为了提高索引性能(以牺牲查询精度为代价)，显式地定义<code class="literal">tree_level</code>或 <code class="literal">precision</code>，并使用合理的<code class="literal">distance_error_pct</code>，注意大的形状会有更大的误报。

注意：此参数仅与<code class="literal">term</code>(词项) 和 <code class="literal">recursive</code>(递归) 策略相关。
</p></td>
<td align="left" valign="top"><p><code class="literal">0.025</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">orientation</code></p></td>
<td align="left" valign="top"><p>
选择性地定义如何解释多边形/多重多边形的顶点顺序。

该参数定义了两个坐标系规则(右手 right-hand 或左手 left-hand)中的一个，每一个都可以用三种不同的方式指定。

1. 右手(right-hand) 规则：<code class="literal">right</code>、<code class="literal">ccw</code>、<code class="literal">counterclockwise</code><span class="remark">(逆时针)</span>；

2. 左手(left-hand)规则：<code class="literal">left</code>、<code class="literal">cw</code>、<code class="literal">clockwise</code><span class="remark">(顺时针)</span>。

默认方向(<code class="literal">counterclockwise</code>，逆时针)符合 OGC 标准，该标准以逆时针顺序定义外环顶点，以顺时针顺序定义内环顶点(孔)。

在 geo_shape 映射中设置此参数会为 geo_shape 字段的坐标列表显式设置折点顺序，但可以被每个单独的 GeoJSON 或 WKT 文档所覆盖。
</p></td>
<td align="left" valign="top"><p><code class="literal">ccw</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">points_only</code></p></td>
<td align="left" valign="top"><p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
将此选项设置为<code class="literal">true</code>(默认为<code class="literal">false</code>)将仅为 点(point) 形状配置 geo_shape 字段类型(注意：尚不支持多点)。

当已知只有点将被索引时，这优化了 <code class="literal">geohash</code> 和 <code class="literal">quadtree</code> 的索引编制和搜索性能。

目前，不能在<code class="literal">geo_point</code>类型的字段上执行 geo_shape 查询。

此选项通过提高<code class="literal">geo_shape</code>字段的点性能来弥补这一差距，从而使<code class="literal">geo_shape</code>查询在 "point only" 字段上达到最佳效果。
</p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_malformed</code></p></td>
<td align="left" valign="top"><p>
如果为 true，则忽略格式错误的 GeoJSON 或 WKT 形状。

如果为 false(默认值)，格式错误的 GeoJSON 和 WKT 形状将导致异常并拒绝整个文档。
</p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">ignore_z_value</code></p></td>
<td align="left" valign="top"><p>
如果为<code class="literal">true</code>(默认)，将接受三个维度点(存储在source中),但仅索引纬度(latitude)和经度(longitude)值；第三维度被忽略。

如果为<code class="literal">false</code>，包含任何超过纬度和经度(二维)值的地理坐标点将导致异常并拒绝整个文档。
</p></td>
<td align="left" valign="top"><p><code class="literal">true</code></p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">coerce</code></p></td>
<td align="left" valign="top"><p>如果为<code class="literal">true</code>，多边形中未闭合的线性环将自动闭合。</p></td>
<td align="left" valign="top"><p><code class="literal">false</code></p></td>
</tr>
</tbody>
</table>
</div>
<h4>
<a id="geoshape-indexing-approach"></a>编制索引的方法
</h4>
<p>
通过将形状分解成三角形网格并将每个三角形索引为 BKD 树中的 7 维点来索引 geo_shape 类型。

这提供了近乎完美的空间分辨率(低至1e<sup>-7</sup>十进制精度)，因为所有空间关系都是使用原始形状的编码矢量表示来计算的，而不是<a class="xref" href="geo-shape.html#prefix-trees" title="前缀树">前缀树(prefix trees)</a>索引方法所使用的光栅网格表示。

镶嵌器的性能主要取决于定义多边形/多多边形的顶点数量。

虽然这是默认的索引技术，但是仍然可以通过根据适当的<a class="xref" href="geo-shape.html#geo-shape-mapping-options" title="映射选项">M映射选项</a>设置<code class="literal">tree</code>或<code class="literal">strategy</code>参数来使用前缀树。

请注意，这些参数现在已被废弃，并将在未来版本中删除。
</p>
<p><span class="strong strong"><strong>重要提示</strong></span></p>
<p>
<code class="literal">CONTAINS</code>(包含) 关系查询 - 当使用新的默认向量索引策略时，使用7.5.0或更高版本的 ElasticSearch 创建的索引支持把<code class="literal">relation</code>定义为<code class="word">contains</code>的<code class="literal">geo_shape</code>查询。
</p>
<h4>
<a id="prefix-trees"></a>前缀树(prefix trees)
</h4>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
为了在倒排索引中有效地表示形状，使用 PrefixTree (前缀树)的实现将形状转换为一系列表示网格正方形(通常称为 rasters, 即“栅格”)的哈希。

树的概念来自于 PrefixTree 使用多个网格层的事实，每个网格层都以越来越高的精度来表示 Earth(地球)。

这可以被认为是在更高的缩放级别下增加地图或图像的细节级别。

由于这种方法会导致索引的形状的精度问题，因此它已被弃用，取而代之的是将形状索引为三角形网格的矢量索引方法(参考<a class="xref" href="geo-shape.html#geoshape-indexing-approach" title="索引方法">索引方法</a>)。
</p>
<p>提供了多个 PrefixTree 实现方法：</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
GeohashPrefixTree：将<a href="http://en.wikipedia.org/wiki/Geohash" class="ulink" target="_top">geohash(地理哈希)</a>用于网格正方形。

geohash 是经纬度交织的 base32 编码的字符串。

添加到 geohash 的每个字符代表另一个树级别，并为 geohash 增加 5 比特位的精度。

geohash 表示一个矩形区域，有32个子矩形。

Elasticsearch中的最大级数为 24；默认值为 9。
</li>
<li class="listitem">
QuadPrefixTree：将<a href="http://en.wikipedia.org/wiki/Quadtree" class="ulink" target="_top">quadtree(四叉树)</a>用于网格正方形。

与 geohash 类似，quadtree(四叉树)交织纬度和经度的比特位，产生的哈希是一个比特位集。

四叉树中的树级别表示该比特位集中的 2 位，每个坐标一位。

Elasticsearch中四叉树的最大层数是 29；默认值为 21。
</li>
</ul>
</div>
<h5>
<a id="spatial-strategy"></a>空间策略
</h5>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
在6.6版本中废弃。不再使用 前缀树(PrefixTree)。
</span>
</span>
所选择的索引实现方法依赖于选择如何分解形状(作为网格正方形或镶嵌的三角形网格)的空间策略。

每个策略回答以下问题：
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
什么类型的形状可以被索引？
</li>
<li class="listitem">
可以使用哪些类型的查询操作和形状？
</li>
<li class="listitem">
它是否支持每个字段有多个形状？
</li>
</ul>
</div>
<p>提供了以下策略实现方法(具有相应的功能)：</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3">
<col class="col_4">
</colgroup>
<thead>
<tr>
<th align="left" valign="top">策略</th>
<th align="left" valign="top">支持的形状</th>
<th align="left" valign="top">支持的查询</th>
<th align="left" valign="top">多形状</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">recursive</code></p></td>
<td align="left" valign="top"><p><a class="xref" href="geo-shape.html#input-structure" title="Input Structure">所有</a></p></td>
<td align="left" valign="top"><p><code class="literal">INTERSECTS</code>、<code class="literal">DISJOINT</code>、<code class="literal">WITHIN</code>、<code class="literal">CONTAINS</code></p></td>
<td align="left" valign="top"><p>是</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">term</code></p></td>
<td align="left" valign="top"><p><a class="xref" href="shape.html#point" title="点">点</a></p></td>
<td align="left" valign="top"><p><code class="literal">INTERSECTS</code></p></td>
<td align="left" valign="top"><p>是</p></td>
</tr>
</tbody>
</table>
</div>
<h5>
<a id="_accuracy"></a>精确度
</h5>
<p>
<code class="literal">recursive</code>和<code class="literal">term</code>策略不能提供100%的准确性，并且根据它们的配置方式，它可能会为<code class="literal">INTERSECTS</code>、<code class="literal">WITHIN</code>和<code class="literal">CONTAINS</code>查询返回一些假阳性，为<code class="literal">DISJOINT</code>查询返回一些假阴性。

为了减轻这种情况，为参数 tree_levels 选择一个合适的值并相应地调整期望值是很重要的。

例如，某个点可能靠近特定网格单元的边界，因此可能与仅匹配其旁边单元的查询不匹配，即使形状非常接近该点。
</p>
<h5>
<a id="_example_5"></a>示例
</h5>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /index_name
{
    "mappings": {
        "properties": {
            "location": {
                "type": "geo_shape"
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/633.console"></div>
<p>This mapping definition maps the location field to the geo_shape
type using the default vector implementation. It provides
approximately 1e-7 decimal degree precision.</p>
<h5>
<a id="_performance_considerations_with_prefix_trees"></a>Performance considerations with Prefix Trees<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p><span class="Admonishment Admonishment--change">
[<span class="Admonishment-version u-mono u-strikethrough">6.6</span>]
<span class="Admonishment-detail">
Deprecated in 6.6. PrefixTrees no longer used
</span>
</span> With prefix trees,
Elasticsearch uses the paths in the tree as terms in the inverted index
and in queries. The higher the level (and thus the precision), the more
terms are generated. Of course, calculating the terms, keeping them in
memory, and storing them on disk all have a price. Especially with higher
tree levels, indices can become extremely large even with a modest amount
of data. Additionally, the size of the features also matters. Big, complex
polygons can take up a lot of space at higher tree levels. Which setting
is right depends on the use case. Generally one trades off accuracy against
index size and query performance.</p>
<p>The defaults in Elasticsearch for both implementations are a compromise
between index size and a reasonable level of precision of 50m at the
equator. This allows for indexing tens of millions of shapes without
overly bloating the resulting index too much relative to the input size.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Geo-shape queries on geo-shapes implemented with PrefixTrees will not be executed if
<a class="xref" href="query-dsl.html#query-dsl-allow-expensive-queries"><code class="literal">search.allow_expensive_queries</code></a> is set to false.</p>
</div>
</div>
<h4>
<a id="input-structure"></a>Input Structure<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h4>
<p>Shapes can be represented using either the <a href="http://www.geojson.org" class="ulink" target="_top">GeoJSON</a>
or <a href="http://docs.opengeospatial.org/is/12-063r5/12-063r5.html" class="ulink" target="_top">Well-Known Text</a>
(WKT) format. The following table provides a mapping of GeoJSON and WKT
to Elasticsearch types:</p>
<div class="informaltable">
<table border="1" cellpadding="4px">
<colgroup>
<col class="col_1">
<col class="col_2">
<col class="col_3">
<col class="col_4">
</colgroup>
<thead>
<tr>
<th align="left" valign="top">GeoJSON Type</th>
<th align="left" valign="top">WKT Type</th>
<th align="left" valign="top">Elasticsearch Type</th>
<th align="left" valign="top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p><code class="literal">Point</code></p></td>
<td align="left" valign="top"><p><code class="literal">POINT</code></p></td>
<td align="left" valign="top"><p><code class="literal">point</code></p></td>
<td align="left" valign="top"><p>A single geographic coordinate. Note: Elasticsearch uses WGS-84 coordinates only.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">LineString</code></p></td>
<td align="left" valign="top"><p><code class="literal">LINESTRING</code></p></td>
<td align="left" valign="top"><p><code class="literal">linestring</code></p></td>
<td align="left" valign="top"><p>An arbitrary line given two or more points.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">Polygon</code></p></td>
<td align="left" valign="top"><p><code class="literal">POLYGON</code></p></td>
<td align="left" valign="top"><p><code class="literal">polygon</code></p></td>
<td align="left" valign="top"><p>A <em>closed</em> polygon whose first and last point
must match, thus requiring <code class="literal">n + 1</code> vertices to create an <code class="literal">n</code>-sided
polygon and a minimum of <code class="literal">4</code> vertices.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">MultiPoint</code></p></td>
<td align="left" valign="top"><p><code class="literal">MULTIPOINT</code></p></td>
<td align="left" valign="top"><p><code class="literal">multipoint</code></p></td>
<td align="left" valign="top"><p>An array of unconnected, but likely related
points.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">MultiLineString</code></p></td>
<td align="left" valign="top"><p><code class="literal">MULTILINESTRING</code></p></td>
<td align="left" valign="top"><p><code class="literal">multilinestring</code></p></td>
<td align="left" valign="top"><p>An array of separate linestrings.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">MultiPolygon</code></p></td>
<td align="left" valign="top"><p><code class="literal">MULTIPOLYGON</code></p></td>
<td align="left" valign="top"><p><code class="literal">multipolygon</code></p></td>
<td align="left" valign="top"><p>An array of separate polygons.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">GeometryCollection</code></p></td>
<td align="left" valign="top"><p><code class="literal">GEOMETRYCOLLECTION</code></p></td>
<td align="left" valign="top"><p><code class="literal">geometrycollection</code></p></td>
<td align="left" valign="top"><p>A GeoJSON shape similar to the
<code class="literal">multi*</code> shapes except that multiple types can coexist (e.g., a Point
and a LineString).</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">N/A</code></p></td>
<td align="left" valign="top"><p><code class="literal">BBOX</code></p></td>
<td align="left" valign="top"><p><code class="literal">envelope</code></p></td>
<td align="left" valign="top"><p>A bounding rectangle, or envelope, specified by
specifying only the top left and bottom right points.</p></td>
</tr>
<tr>
<td align="left" valign="top"><p><code class="literal">N/A</code></p></td>
<td align="left" valign="top"><p><code class="literal">N/A</code></p></td>
<td align="left" valign="top"><p><code class="literal">circle</code></p></td>
<td align="left" valign="top"><p>A circle specified by a center point and radius with
units, which default to <code class="literal">METERS</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>For all types, both the inner <code class="literal">type</code> and <code class="literal">coordinates</code> fields are
required.</p>
<p>In GeoJSON and WKT, and therefore Elasticsearch, the correct <span class="strong strong"><strong>coordinate
order is longitude, latitude (X, Y)</strong></span> within coordinate arrays. This
differs from many Geospatial APIs (e.g., Google Maps) that generally
use the colloquial latitude, longitude (Y, X).</p>
</div>
</div>
<h5>
<a id="geo-point-type"></a><a href="http://geojson.org/geojson-spec.html#id2" class="ulink" target="_top">Point</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>A point is a single geographic coordinate, such as the location of a
building or the current position given by a smartphone’s Geolocation
API. The following is an example of a point in GeoJSON.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "point",
        "coordinates" : [-77.03653, 38.897676]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/634.console"></div>
<p>The following is an example of a point in WKT:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "POINT (-77.03653 38.897676)"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/635.console"></div>
<h5>
<a id="geo-linestring"></a><a href="http://geojson.org/geojson-spec.html#id3" class="ulink" target="_top">LineString</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>A <code class="literal">linestring</code> defined by an array of two or more positions. By
specifying only two points, the <code class="literal">linestring</code> will represent a straight
line.  Specifying more than two points creates an arbitrary path. The
following is an example of a LineString in GeoJSON.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "linestring",
        "coordinates" : [[-77.03653, 38.897676], [-77.009051, 38.889939]]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/636.console"></div>
<p>The following is an example of a LineString in WKT:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "LINESTRING (-77.03653 38.897676, -77.009051 38.889939)"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/637.console"></div>
<p>The above <code class="literal">linestring</code> would draw a straight line starting at the White
House to the US Capitol Building.</p>
<h5>
<a id="geo-polygon"></a><a href="http://www.geojson.org/geojson-spec.html#id4" class="ulink" target="_top">Polygon</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>A polygon is defined by a list of a list of points. The first and last
points in each (outer) list must be the same (the polygon must be
closed). The following is an example of a Polygon in GeoJSON.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/638.console"></div>
<p>The following is an example of a Polygon in WKT:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "POLYGON ((100.0 0.0, 101.0 0.0, 101.0 1.0, 100.0 1.0, 100.0 0.0))"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/639.console"></div>
<p>The first array represents the outer boundary of the polygon, the other
arrays represent the interior shapes ("holes"). The following is a GeoJSON example
of a polygon with a hole:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0] ],
            [ [100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/640.console"></div>
<p>The following is an example of a Polygon with a hole in WKT:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "POLYGON ((100.0 0.0, 101.0 0.0, 101.0 1.0, 100.0 1.0, 100.0 0.0), (100.2 0.2, 100.8 0.2, 100.8 0.8, 100.2 0.8, 100.2 0.2))"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/641.console"></div>
<p><span class="strong strong"><strong>IMPORTANT NOTE:</strong></span> WKT does not enforce a specific order for vertices thus
ambiguous polygons around the dateline and poles are possible.
<a href="https://tools.ietf.org/html/rfc7946#section-3.1.6" class="ulink" target="_top">GeoJSON</a> mandates that the
outer polygon must be counterclockwise and interior shapes must be clockwise,
which agrees with the Open Geospatial Consortium (OGC)
<a href="http://www.opengeospatial.org/standards/sfa" class="ulink" target="_top">Simple Feature Access</a>
specification for vertex ordering.</p>
<p>Elasticsearch accepts both clockwise and counterclockwise polygons if they
appear not to cross the dateline (i.e. they cross less than 180° of longitude),
but for polygons that do cross the dateline (or for other polygons wider than
180°) Elasticsearch requires the vertex ordering to comply with the OGC and
GeoJSON specifications. Otherwise, an unintended polygon may be created and
unexpected query/filter results will be returned.</p>
<p>The following provides an example of an ambiguous polygon.  Elasticsearch will
apply the GeoJSON standard to eliminate ambiguity resulting in a polygon that
crosses the dateline.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "polygon",
        "coordinates" : [
            [ [-177.0, 10.0], [176.0, 15.0], [172.0, 0.0], [176.0, -15.0], [-177.0, -10.0], [-177.0, 10.0] ],
            [ [178.2, 8.2], [-178.8, 8.2], [-180.8, -8.8], [178.2, 8.8] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/642.console"></div>
<p>An <code class="literal">orientation</code> parameter can be defined when setting the geo_shape mapping (see <a class="xref" href="geo-shape.html#geo-shape-mapping-options" title="Mapping Options">Mapping Options</a>). This will define vertex
order for the coordinate list on the mapped geo_shape field. It can also be overridden on each document.  The following is an example for
overriding the orientation on a document:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "polygon",
        "orientation" : "clockwise",
        "coordinates" : [
            [ [100.0, 0.0], [100.0, 1.0], [101.0, 1.0], [101.0, 0.0], [100.0, 0.0] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/643.console"></div>
<h5>
<a id="geo-multipoint"></a><a href="http://www.geojson.org/geojson-spec.html#id5" class="ulink" target="_top">MultiPoint</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>The following is an example of a list of geojson points:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "multipoint",
        "coordinates" : [
            [102.0, 2.0], [103.0, 2.0]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/644.console"></div>
<p>The following is an example of a list of WKT points:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "MULTIPOINT (102.0 2.0, 103.0 2.0)"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/645.console"></div>
<h5>
<a id="geo-multilinestring"></a><a href="http://www.geojson.org/geojson-spec.html#id6" class="ulink" target="_top">MultiLineString</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>The following is an example of a list of geojson linestrings:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "multilinestring",
        "coordinates" : [
            [ [102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0] ],
            [ [100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0] ],
            [ [100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/646.console"></div>
<p>The following is an example of a list of WKT linestrings:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "MULTILINESTRING ((102.0 2.0, 103.0 2.0, 103.0 3.0, 102.0 3.0), (100.0 0.0, 101.0 0.0, 101.0 1.0, 100.0 1.0), (100.2 0.2, 100.8 0.2, 100.8 0.8, 100.2 0.8))"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/647.console"></div>
<h5>
<a id="geo-multipolygon"></a><a href="http://www.geojson.org/geojson-spec.html#id7" class="ulink" target="_top">MultiPolygon</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>The following is an example of a list of geojson polygons (second polygon contains a hole):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "multipolygon",
        "coordinates" : [
            [ [[102.0, 2.0], [103.0, 2.0], [103.0, 3.0], [102.0, 3.0], [102.0, 2.0]] ],
            [ [[100.0, 0.0], [101.0, 0.0], [101.0, 1.0], [100.0, 1.0], [100.0, 0.0]],
              [[100.2, 0.2], [100.8, 0.2], [100.8, 0.8], [100.2, 0.8], [100.2, 0.2]] ]
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/648.console"></div>
<p>The following is an example of a list of WKT polygons (second polygon contains a hole):</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "MULTIPOLYGON (((102.0 2.0, 103.0 2.0, 103.0 3.0, 102.0 3.0, 102.0 2.0)), ((100.0 0.0, 101.0 0.0, 101.0 1.0, 100.0 1.0, 100.0 0.0), (100.2 0.2, 100.8 0.2, 100.8 0.8, 100.2 0.8, 100.2 0.2)))"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/649.console"></div>
<h5>
<a id="geo-geometry_collection"></a><a href="http://geojson.org/geojson-spec.html#geometrycollection" class="ulink" target="_top">Geometry Collection</a><a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>The following is an example of a collection of geojson geometry objects:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type": "geometrycollection",
        "geometries": [
            {
                "type": "point",
                "coordinates": [100.0, 0.0]
            },
            {
                "type": "linestring",
                "coordinates": [ [101.0, 0.0], [102.0, 1.0] ]
            }
        ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/650.console"></div>
<p>The following is an example of a collection of WKT geometry objects:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "GEOMETRYCOLLECTION (POINT (100.0 0.0), LINESTRING (101.0 0.0, 102.0 1.0))"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/651.console"></div>
<h5>
<a id="_envelope"></a>Envelope<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>Elasticsearch supports an <code class="literal">envelope</code> type, which consists of coordinates
for upper left and lower right points of the shape to represent a
bounding rectangle in the format <code class="literal">[[minLon, maxLat], [maxLon, minLat]]</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "envelope",
        "coordinates" : [ [100.0, 1.0], [101.0, 0.0] ]
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/652.console"></div>
<p>The following is an example of an envelope using the WKT BBOX format:</p>
<p><span class="strong strong"><strong>NOTE:</strong></span> WKT specification expects the following order: minLon, maxLon, maxLat, minLat.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : "BBOX (100.0, 102.0, 2.0, 0.0)"
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/653.console"></div>
<h5>
<a id="_circle"></a>Circle<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h5>
<p>Elasticsearch supports a <code class="literal">circle</code> type, which consists of a center
point with a radius. Note that this circle representation can only
be indexed when using the <code class="literal">recursive</code> Prefix Tree strategy. For
the default <a class="xref" href="geo-shape.html#geoshape-indexing-approach" title="Indexing approach">Indexing approach</a> circles should be approximated using
a <code class="literal">POLYGON</code>.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST /example/_doc
{
    "location" : {
        "type" : "circle",
        "coordinates" : [101.0, 1.0],
        "radius" : "100m"
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/654.console"></div>
<p>Note: The inner <code class="literal">radius</code> field is required. If not specified, then
the units of the <code class="literal">radius</code> will default to <code class="literal">METERS</code>.</p>
<p><span class="strong strong"><strong>NOTE:</strong></span> Neither GeoJSON or WKT support a point-radius circle type.</p>
<h4>
<a id="_sorting_and_retrieving_index_shapes"></a>Sorting and Retrieving index Shapes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping/types/geo-shape.asciidoc">edit</a>
</h4>
<p>Due to the complex input structure and index representation of shapes,
it is not currently possible to sort shapes or retrieve their fields
directly. The geo_shape value is only retrievable through the <code class="literal">_source</code>
field.</p>
</div>
<div class="navfooter">
<span class="prev">
<a href="geo-point.html">« geo_point(地理坐标点)数据类型</a>
</span>
<span class="next">
<a href2="ip.html">IP datatype »</a>
</span>
</div>
</div>

                  <!-- end body -->
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                        
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</div>
<script src="../static/cn.js"></script>
</body>
</html>