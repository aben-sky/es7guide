<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>映射 | ElasticSearch 7.7 权威指南中文版</title>
	<meta name="keywords" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <meta name="description" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="../static/styles.css" />
	<script>
	var _link = 'mapping.html';
    </script>
</head>
<body>
<div class="main-container">
    <section id="content">
        <div class="content-wrapper">
            <section id="guide" lang="zh_cn">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                            <div style="color:gray; word-break: break-all; font-size:12px;">原英文版地址: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.7/mapping.html" rel="nofollow" target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/7.7/mapping.html</a>, 原文档版权归 www.elastic.co 所有<br/>本地英文版地址: <a href="../en/mapping.html" rel="nofollow" target="_blank">../en/mapping.html</a></div>
                        <!-- start body -->
                  <div class="page_header">
<strong>重要</strong>: 此版本不会发布额外的bug修复或文档更新。最新信息请参考 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" rel="nofollow">当前版本文档</a>。
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch 权威指南 [7.7]</a></span>
»
<span class="breadcrumb-node">映射</span>
</div>
<div class="navheader">
<span class="prev">
<a href="modules-scripting-engine.html">« 高级脚本使用脚本引擎</a>
</span>
<span class="next">
<a href2="removal-of-types.html">Removal of mapping types »</a>
</span>
</div>
<div class="part">
<div class="titlepage"><div><div>
<h1 class="title">
<a id="mapping"></a>映射(mapping)
</h1>
</div></div></div>
<div class="openblock partintro">
<div class="content">
<p>
映射(mapping)是定义如何存储和索引文档及其包含的字段的过程。

例如，可以使用映射来定义：
</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
哪些字符串字段应被视为全文字段。
</li>
<li class="listitem">
哪些字段包含数字、日期或地理位置。
</li>
<li class="listitem">
日期值的<a class="xref" href="mapping-date-format.html" title="格式" rel="nofollow">格式(format)</a>
。</li>
<li class="listitem">
控制<a class="xref" href="dynamic-mapping.html" title="Dynamic Mapping">动态添加字段</a>映射的自定义规则。
</li>
</ul>
</div>
<p>映射的定义具有：</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<a class="xref" href="mapping-fields.html" title="元字段" rel="nofollow">元字段(meta-fields)</a>
</span>
</dt>
<dd>
元字段(meta-fields)用于定制如何处理文档关联的元数据。

元字段的例子包括文档的 <a class="xref" href="mapping-index-field.html" title="_index字段" rel="nofollow"><code class="literal">_index</code></a>、<a class="xref" href="mapping-id-field.html" title="_id字段" rel="nofollow"><code class="literal">_id</code></a> 及 <a class="xref" href="mapping-source-field.html" title="_source字段" rel="nofollow"><code class="literal">_source</code></a>字段。
</dd>
<dt>
<span class="term">
<a class="xref" href="mapping-types.html" title="Field datatypes">字段(fields)</a>或<em>属性(properties)</em>
</span>
</dt>
<dd>
映射包含与文档相关的 字段(field) 或 属性(<code class="literal">properties</code>) 的列表。
</dd>
</dl>
</div>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>
在7.0.0之前，<em>mappings</em>定义曾经包含 type。

更多信息请参考 <a class="xref" href="removal-of-types.html" title="Removal of mapping types"><em>删除的映射类型</em></a>。
</p>
</div>
</div>
<h2>
<a id="field-datatypes"></a>字段数据类型
</h2>
<p>每个字段都有一个数据类型(<code class="literal">type</code>)，可以是：</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
简单类型，如<a class="xref" href="text.html" title="text 数据类型" rel="nofollow"><code class="literal">text</code></a>、<a class="xref" href="keyword.html" title="keyword 数据类型" rel="nofollow"><code class="literal">keyword</code></a>、<a class="xref" href="date.html" title="date 数据类型" rel="nofollow"><code class="literal">date</code></a>、<a class="xref" href="number.html" title="numeric 数据类型" rel="nofollow"><code class="literal">long</code></a>、<a class="xref" href="number.html" title="numeric 数据类型" rel="nofollow"><code class="literal">double</code></a>、<a class="xref" href="boolean.html" title="boolean 数据类型" rel="nofollow"><code class="literal">boolean</code></a> 及 <a class="xref" href="ip.html" title="ip 数据类型" rel="nofollow"><code class="literal">ip</code></a>。
</li>
<li class="listitem">
支持JSON分层性质的类型，如<a class="xref" href="object.html" title="object 数据类型" rel="nofollow"><code class="literal">object</code></a> 及 <a class="xref" href="nested.html" title="nested 数据类型" rel="nofollow"><code class="literal">nested</code></a>。
</li>
<li class="listitem">
或者一种特殊的类型，如 <a class="xref" href="geo-point.html" title="geo-point 数据类型" rel="nofollow"><code class="literal">geo_point</code></a>、<a class="xref" href="geo-shape.html" title="geo-shape 数据类型" rel="nofollow"><code class="literal">geo_shape</code></a> 及 <a class="xref" href="search-suggesters.html#completion-suggester" title="完成建议" rel="nofollow"><code class="literal">completion</code></a>。
</li>
</ul>
</div>
<p>
出于不同的目的，以不同的方式索引同一个字段通常是有用的。

例如，一个<code class="literal">string</code>字段可以<a class="xref" href="mapping-index.html" title="index">索引(indexed)</a>为一个<code class="literal">text</code>字段用于全文搜索，也可以索引为一个<code class="literal">keyword</code>字段用于排序或聚合。

或者，你可以使用<a class="xref" href="analysis-standard-analyzer.html" title="Standard 分析器" rel="nofollow"><code class="literal">standard</code>分析器</a>、<a class="xref" href="analysis-lang-analyzer.html#english-analyzer" title="english 分析器" rel="nofollow"><code class="literal">english</code>分析器</a>和<a class="xref" href="analysis-lang-analyzer.html#french-analyzer" title="french 分析器" rel="nofollow"><code class="literal">french</code>分析器</a>来索引一个 string 字段。
</p>
<p>
这就是 多字段(<em>multi-fields</em>) 的目的。

大多数数据类型通过参数<a class="xref" href="multi-fields.html" title="字段" rel="nofollow"><code class="literal">fields</code></a>支持多字段。
</p>
<h3>
<a id="mapping-limit-settings"></a>防止映射爆炸的设置
</h3>
<p>在索引中定义太多字段会导致映射爆炸，从而导致内存不足错误和难以恢复的情况。</p>
<p>
考虑这样一种情况，其中插入的每个新文档都引入了新的字段，例如<a class="xref" href="dynamic-mapping.html" title="动态映射" rel="nofollow">动态映射(dynamic mapping)</a>。

每个新字段都被添加到索引的映射中，随着映射的增长，这可能会成为一个问题。
</p>
<p>使用以下设置来限制(手动或动态创建的)字段映射的数量，并防止文档导致映射爆炸：</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index.mapping.total_fields.limit</code>
</span>
</dt>
<dd>
<p>
索引中字段的最大数量。字段和对象映射以及字段别名都计入此限制。默认值为 <code class="literal">1000</code>。
</p>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>
这个限制是为了防止映射和搜索变得太大。

较大的值可能会导致性能下降和内存问题，尤其是在负载高或资源少的集群中。
</p>
<p>
如果增加了此设置，我们建议也增加<a class="xref" href="search-settings.html" title="搜索设置" rel="nofollow"><code class="literal">indices.query.bool.max_clause_count</code></a>设置，该设置限制查询中<a class="xref" href="query-dsl-bool-query.html" title="布尔查询" rel="nofollow">布尔(bool)子句</a>的最大数量。
</p>
</div>
</div>
<div class="tip admon">
<div class="icon"></div>
<div class="admon_content">
<p>如果字段映射中包含一组大型的任意键，请考虑使用<a class="xref" href="flattened.html" title="flattened 数据类型" rel="nofollow">flattened</a>数据类型。</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">index.mapping.depth.limit</code>
</span>
</dt>
<dd>
字段的最大深度，以内部对象的数量来度量。

例如，如果所有字段都是在根对象级别定义的，那么深度就是<code class="literal">1</code>。

如果有一个对象映射，则深度为<code class="literal">2</code>，等等。默认值为<code class="literal">20</code>。
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index.mapping.nested_fields.limit</code>
</span>
</dt>
<dd>
The maximum number of distinct <code class="literal">nested</code> mappings in an index. The <code class="literal">nested</code> type should only be used in special cases, when arrays of objects need to be queried independently of each other. To safeguard against poorly designed mappings, this setting
limits the number of unique <code class="literal">nested</code> types per index. Default is <code class="literal">50</code>.
</dd>
</dl>
</div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">index.mapping.nested_objects.limit</code>
</span>
</dt>
<dd>
The maximum number of nested JSON objects that a single document can contain across all
<code class="literal">nested</code> types. This limit helps to prevent out of memory errors when a document contains too many nested
objects. Default is <code class="literal">10000</code>.
</dd>
<dt>
<span class="term">
<code class="literal">index.mapping.field_name_length.limit</code>
</span>
</dt>
<dd>
Setting for the maximum length of a field name. This setting isn’t really something that addresses
mappings explosion but might still be useful if you want to limit the field length.
It usually shouldn’t be necessary to set this setting. The default is okay
unless a user starts to add a huge number of fields with really long names. Default is
<code class="literal">Long.MAX_VALUE</code> (no limit).
</dd>
</dl>
</div>
<h2>
<a id="_dynamic_mapping"></a>Dynamic mapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>Fields and mapping types do not need to be defined before being used. Thanks
to <em>dynamic mapping</em>, new field names will be added automatically, just by
indexing a document. New fields can be added both to the top-level mapping
type, and to inner <a class="xref" href="object.html" title="Object datatype"><code class="literal">object</code></a>  and <a class="xref" href="nested.html" title="Nested datatype"><code class="literal">nested</code></a> fields.</p>
<p>The <a class="xref" href="dynamic-mapping.html" title="Dynamic Mapping">dynamic mapping</a> rules can be configured to customise
the mapping that is used for new fields.</p>
<h2>
<a id="_explicit_mappings"></a>Explicit mappings<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>You know more about your data than Elasticsearch can guess, so while dynamic
mapping can be useful to get started, at some point you will want to specify
your own explicit mappings.</p>
<p>You can create field mappings when you <a class="xref" href="mapping.html#create-mapping" title="Create an index with an explicit mapping">create an index</a> and
<a class="xref" href="mapping.html#add-field-mapping" title="Add a field to an existing mapping">add fields to an existing index</a>.</p>
<h2>
<a id="create-mapping"></a>Create an index with an explicit mapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>You can use the <a class="xref" href="indices-create-index.html" title="Create index API">create index</a> API to create a new index
with an explicit mapping.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index
{
  "mappings": {
    "properties": {
      "age":    { "type": "integer" },  <a id="CO283-1"></a><i class="conum" data-value="1"></i>
      "email":  { "type": "keyword"  }, <a id="CO283-2"></a><i class="conum" data-value="2"></i>
      "name":   { "type": "text"  }     <a id="CO283-3"></a><i class="conum" data-value="3"></i>
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/603.console"></div>
<div class="calloutlist">
<table border="0" summary="Callout list">
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO283-1"><i class="conum" data-value="1"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates <code class="literal">age</code>, an <a class="xref" href="number.html" title="Numeric datatypes"><code class="literal">integer</code></a> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO283-2"><i class="conum" data-value="2"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates <code class="literal">email</code>, a <a class="xref" href="keyword.html" title="Keyword datatype"><code class="literal">keyword</code></a> field</p>
</td>
</tr>
<tr>
<td align="left" valign="top" width="5%">
<p><a href="#CO283-3"><i class="conum" data-value="3"></i></a></p>
</td>
<td align="left" valign="top">
<p>Creates <code class="literal">name</code>, a <a class="xref" href="text.html" title="Text datatype"><code class="literal">text</code></a> field</p>
</td>
</tr>
</table>
</div>
<h2>
<a id="add-field-mapping"></a>Add a field to an existing mapping<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>You can use the <a class="xref" href="indices-put-mapping.html" title="Put mapping API">put mapping</a> API to add one or more new
fields to an existing index.</p>
<p>The following example adds <code class="literal">employee-id</code>, a <code class="literal">keyword</code> field with an
<a class="xref" href="mapping-index.html" title="index"><code class="literal">index</code></a> mapping parameter value of <code class="literal">false</code>. This means values
for the <code class="literal">employee-id</code> field are stored but not indexed or available for search.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">PUT /my-index/_mapping
{
  "properties": {
    "employee-id": {
      "type": "keyword",
      "index": false
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/604.console"></div>
<h3>
<a id="update-mapping"></a>Update the mapping of a field<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h3>
<p>Except for supported <a class="xref" href="mapping-params.html" title="Mapping parameters">mapping parameters</a>,
you can’t change the mapping or field type of an existing field.
Changing an existing field could invalidate data that’s already indexed.</p>
<p>If you need to change the mapping of a field,
create a new index with the correct mapping
and <a class="xref" href="docs-reindex.html" title="Reindex API">reindex</a> your data into that index.</p>
<p>Renaming a field would invalidate data already indexed under the old field name.
Instead, add an <a class="xref" href="alias.html" title="Alias datatype"><code class="literal">alias</code></a> field to create an alternate field name.</p>
<h2>
<a id="view-mapping"></a>View the mapping of an index<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>You can use the <a class="xref" href="indices-get-mapping.html" title="Get mapping API">get mapping</a> API to view the mapping of
an existing index.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index/_mapping</pre>
</div>
<div class="console_widget" data-snippet="snippets/605.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "my-index" : {
    "mappings" : {
      "properties" : {
        "age" : {
          "type" : "integer"
        },
        "email" : {
          "type" : "keyword"
        },
        "employee-id" : {
          "type" : "keyword",
          "index" : false
        },
        "name" : {
          "type" : "text"
        }
      }
    }
  }
}</pre>
</div>
<h2>
<a id="view-field-mapping"></a>View the mapping of specific fields<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/mapping.asciidoc">edit</a>
</h2>
<p>If you only want to view the mapping of one or more specific fields, you can use
the <a class="xref" href="indices-get-field-mapping.html" title="Get field mapping API">get field mapping</a> API.</p>
<p>This is useful if you don’t need the complete mapping of an index or your index
contains a large number of fields.</p>
<p>The following request retrieves the mapping for the <code class="literal">employee-id</code> field.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /my-index/_mapping/field/employee-id</pre>
</div>
<div class="console_widget" data-snippet="snippets/606.console"></div>
<p>The API returns the following response:</p>
<div class="pre_wrapper lang-console-result">
<pre class="programlisting prettyprint lang-console-result">{
  "my-index" : {
    "mappings" : {
      "employee-id" : {
        "full_name" : "employee-id",
        "mapping" : {
          "employee-id" : {
            "type" : "keyword",
            "index" : false
          }
        }
      }
    }
  }
}</pre>
</div>
</div>
</div>





</div>
<div class="navfooter">
<span class="prev">
<a href="modules-scripting-engine.html">« 高级脚本使用脚本引擎</a>
</span>
<span class="next">
<a href2="removal-of-types.html">Removal of mapping types »</a>
</span>
</div>
</div>

                  <!-- end body -->
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                        
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</div>
<script src="../static/cn.js"></script>
</body>
</html>