<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>intervals 查询 | ElasticSearch 7.7 权威指南中文版</title>
	<meta name="keywords" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <meta name="description" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="../static/styles.css" />
	<script>
	var _link = 'query-dsl-intervals-query.html';
    </script>
</head>
<body>
<div class="main-container">
    <section id="content">
        <div class="content-wrapper">
            <section id="guide" lang="zh_cn">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                            <div style="color:gray; word-break: break-all; font-size:12px;">原英文版地址: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.7/query-dsl-intervals-query.html" rel="nofollow" target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/7.7/query-dsl-intervals-query.html</a>, 原文档版权归 www.elastic.co 所有<br/>本地英文版地址: <a href="../en/query-dsl-intervals-query.html" rel="nofollow" target="_blank">../en/query-dsl-intervals-query.html</a></div>
                        <!-- start body -->
                  <div class="page_header">
<strong>重要</strong>: 此版本不会发布额外的bug修复或文档更新。最新信息请参考 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" rel="nofollow">当前版本文档</a>。
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch 权威指南 [7.7]</a></span>
»
<span class="breadcrumb-node">Query DSL</span>
»
<span class="breadcrumb-node">全文查询</span>
<span class="breadcrumb-node">intervals 查询</span>
</div>
<div class="navheader">
<span class="prev">
<a href="full-text-queries.html">« 全文查询</a>
</span>
<span class="next">
<a href2="query-dsl-match-query.html">Match query »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title">
<a id="query-dsl-intervals-query"></a>intervals 查询
</h2>
</div></div></div>

<p>
根据匹配 词项(term) 的顺序和接近程度返回文档。
</p>
<p>
<code class="literal">intervals</code> 查询使用<span class="strong strong"><strong>匹配规则(matching rules)</strong></span>，这些规则由一小组定义构成。

然后将这些规则应用于指定 <code class="literal">字段(field)</code> 中的 词项(term)。
</p>
<p>
这些定义产生的最小区间序列跨越了文本主体中的词项(term)。

这些 间隔(interval) 可以由父源进一步组合和过滤。
</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-query-ex-request"></a>请求示例
</h3>
</div></div></div>
<p>
下面这个 <code class="literal">intervals</code> 搜索返回字段 <code class="literal">my_text</code> 中包含 <code class="literal">my favorite food</code> 的文档，且 <code class="literal">my favorite food</code> 后面紧跟着 <code class="literal">hot water</code> 或 <code class="literal">cold porridge</code>。
</p>
<p>
这个搜索会匹配字段 <code class="literal">my_text</code> 的值为 <code class="literal">my favorite food is cold porridge</code> 的文档，但不会匹配 <code class="literal">when it's cold my favorite food is porridge</code>。
</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "all_of" : {
          "ordered" : true,
          "intervals" : [
            {
              "match" : {
                "query" : "my favorite food",
                "max_gaps" : 0,
                "ordered" : true
              }
            },
            {
              "any_of" : {
                "intervals" : [
                  { "match" : { "query" : "hot water" } },
                  { "match" : { "query" : "cold porridge" } }
                ]
              }
            }
          ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/108.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-top-level-params"></a><code class="literal">intervals</code>的顶级参数
</h3>
</div></div></div>
<div class="variablelist">
<a id="intervals-rules"></a>
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;field&gt;</code>
</span>
</dt>
<dd>
<p>(必填，规则<span class="remark">(rule)</span>对象) 你想搜索的字段。</p>
<p>
该参数的值是一个规则(rule)对象，用于根据匹配的词项(term)、顺序(order)和接近性(proximity)来匹配文档。
</p>
<p>可用的规则(rule)包括：</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-match" title="match rule parameters"><code class="literal">match</code></a> (匹配)
</li>
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-prefix" title="prefix rule parameters"><code class="literal">prefix</code></a> (前缀)
</li>
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-wildcard" title="wildcard rule parameters"><code class="literal">wildcard</code></a> (通配符)
</li>
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-fuzzy" title="fuzzy rule parameters"><code class="literal">fuzzy</code></a> (模糊)
</li>
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-all_of" title="all_of rule parameters"><code class="literal">all_of</code></a> (全部)
</li>
<li class="listitem">
<a class="xref" href="query-dsl-intervals-query.html#intervals-any_of" title="any_of rule parameters"><code class="literal">any_of</code></a> (任意一个)
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-match"></a><code class="literal">match</code>(匹配) 规则参数
</h3>
</div></div></div>
<p><code class="literal">match</code> 匹配规则匹配 已分析的文本(analyzed text)。</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
(必填, string) 你想在指定的 <code class="literal">&lt;field&gt;</code> 中搜索的文本.
</dd>
<dt>
<span class="term">
<code class="literal">max_gaps</code>
</span>
</dt>
<dd>
<p>(可选, integer) 匹配词项之间的最大位置数。比这更远的词项不会被视为匹配。默认值为 <code class="literal">-1</code>。
</p>
<p>
如果未指定或设置为 <code class="literal">-1</code>，则匹配没有宽度限制。

如果设置为 <code class="literal">0</code>，这些词项必须相邻出现。
</p>
</dd>
<dt>
<span class="term">
<code class="literal">ordered</code>
</span>
</dt>
<dd>
(可选, boolean) 如果为 <code class="literal">true</code>，匹配的词项必须按其指定的顺序出现。默认值为 <code class="literal">false</code>。
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
(可选, string) 用于分析 <code class="literal">query</code> 中的 词项(term) 的 <a class="xref" href="analysis.html" title="Text analysis">analyzer(分析器)</a>。

默认为 <code class="literal">&lt;field&gt;</code> 的顶级 分析器(analyzer)。
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(可选, <a class="xref" href="query-dsl-intervals-query.html#interval_filter" title="filter rule parameters">interval filter</a> 规则对象) 一个可选的 interval
filter。
</dd>
<dt>
<span class="term">
<code class="literal">use_field</code>
</span>
</dt>
<dd>
(可选, string)

如果指定了，则匹配此 field 而不是顶级 <code class="literal">&lt;field&gt;</code> 的间隔。

使用 搜索分析器(search analyzer) 分析该字段中的词项(term)。

这将允许你跨多个字段进行搜索，就好像它们是同一个字段；

例如，你可以将相同的文本索引到 带词干(stemmed) 和 不带词干(unstemmed) 的字段，并在不带词干的字段附近搜索带词干的 词元(token)。
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-prefix"></a><code class="literal">prefix</code>(前缀) 规则参数
</h3>
</div></div></div>
<p>
<code class="literal">prefix</code>(前缀) 规则匹配以指定字符集开头的词项。

这个前缀最多可以扩展到匹配 128 个词项。

如果前缀匹配超过 128 个词项，Elasticsearch 将返回一个错误。

可以在字段映射中使用 <a class="xref" href="index-prefixes.html" title="index_prefixes"><code class="literal">index-prefixes</code></a> 选项来避免这个限制。
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">prefix</code>
</span>
</dt>
<dd>
(必填, string) 你希望在顶级 <code class="literal">&lt;field&gt;</code> 中查找的词项的开始字符。
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
(可选, string) 用于归一化 <code class="literal">prefix</code> 的 <a class="xref" href="analysis.html" title="Text analysis">analyzer(分析器)</a>。

默认为 <code class="literal">&lt;field&gt;</code> 的顶级 分析器(analyzer)。
</dd>
<dt>
<span class="term">
<code class="literal">use_field</code>
</span>
</dt>
<dd>
<p>(可选, string) 如果指定了，则匹配此 field 而不是顶级 <code class="literal">&lt;field&gt;</code> 的间隔。
</p>
<p>
如果没有单独指定一个 <code class="literal">analyzer</code>，会使用字段的 搜索分析器(search analyzer) 对 <code class="literal">prefix</code> 进行归一化。
</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-wildcard"></a><code class="literal">wildcard</code>(通配符) 规则参数
</h3>
</div></div></div>
<p>
<code class="literal">wildcard</code> 规则使用一个通配符模式匹配词项。

这个模式最多可以扩展到匹配 128 个词项。

如果前缀匹配超过 128 个词项，Elasticsearch 将返回一个错误。
</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">pattern</code>
</span>
</dt>
<dd>
<p>
(必填, string) 用于查找匹配的词项的通配符模式。
</p>
<p>该参数支持两个通配符操作符：</p>
<div class="ulist itemizedlist">
<ul class="itemizedlist">
<li class="listitem">
<code class="literal">?</code>，它匹配任意的单个字符
</li>
<li class="listitem">
<code class="literal">*</code>，它可以匹配零个或多个字符，包括一个空字符
</li>
</ul>
</div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<p>
避免模式以 <code class="literal">*</code> 或 <code class="literal">?</code>开头。

这可能会增加查找匹配词项所需的迭代次数，并降低搜索性能。
</p>
</div>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
(可选, string) 用于归一化 <code class="literal">pattern</code> 的 <a class="xref" href="analysis.html" title="Text analysis">analyzer(分析器)</a>。

默认为 <code class="literal">&lt;field&gt;</code> 的顶级 分析器(analyzer)。
</dd>
<dt>
<span class="term">
<code class="literal">use_field</code>
</span>
</dt>
<dd>
<p>(可选, string) 
如果指定了，则匹配此 field 而不是顶级 <code class="literal">&lt;field&gt;</code> 的间隔。
</p>
<p>
如果没有单独指定一个 <code class="literal">analyzer</code>，会使用字段的 搜索分析器(search analyzer) 对 <code class="literal">pattern</code> 进行归一化。
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-fuzzy"></a><code class="literal">fuzzy</code> rule parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h3>
</div></div></div>
<p>The <code class="literal">fuzzy</code> rule matches terms that are similar to the provided term, within an
edit distance defined by <a class="xref" href="common-options.html#fuzziness" title="Fuzziness">Fuzziness</a>.  If the fuzzy expansion matches more than
128 terms, Elasticsearch returns an error.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">term</code>
</span>
</dt>
<dd>
(Required, string) The term to match
</dd>
<dt>
<span class="term">
<code class="literal">prefix_length</code>
</span>
</dt>
<dd>
(Optional, integer) Number of beginning characters left unchanged when creating
expansions. Defaults to <code class="literal">0</code>.
</dd>
<dt>
<span class="term">
<code class="literal">transpositions</code>
</span>
</dt>
<dd>
(Optional, boolean) Indicates whether edits include transpositions of two
adjacent characters (ab → ba). Defaults to <code class="literal">true</code>.
</dd>
<dt>
<span class="term">
<code class="literal">fuzziness</code>
</span>
</dt>
<dd>
(Optional, string) Maximum edit distance allowed for matching. See <a class="xref" href="common-options.html#fuzziness" title="Fuzziness">Fuzziness</a>
for valid values and more information.  Defaults to <code class="literal">auto</code>.
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
(Optional, string) <a class="xref" href="analysis.html" title="Text analysis">analyzer</a> used to normalize the <code class="literal">term</code>.
Defaults to the top-level <code class="literal">&lt;field&gt;</code> 's analyzer.
</dd>
<dt>
<span class="term">
<code class="literal">use_field</code>
</span>
</dt>
<dd>
<p>(Optional, string) If specified, match intervals from this field rather than the
top-level <code class="literal">&lt;field&gt;</code>.</p>
<p>The <code class="literal">term</code> is normalized using the search analyzer from this field, unless
<code class="literal">analyzer</code> is specified separately.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-all_of"></a><code class="literal">all_of</code> rule parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h3>
</div></div></div>
<p>The <code class="literal">all_of</code> rule returns matches that span a combination of other rules.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">intervals</code>
</span>
</dt>
<dd>
(Required, array of rule objects) An array of rules to combine. All rules must
produce a match in a document for the overall source to match.
</dd>
<dt>
<span class="term">
<code class="literal">max_gaps</code>
</span>
</dt>
<dd>
<p>(Optional, integer) Maximum number of positions between the matching terms.
Intervals produced by the rules further apart than this are not considered
matches. Defaults to <code class="literal">-1</code>.</p>
<p>If unspecified or set to <code class="literal">-1</code>, there is no width restriction on the match. If
set to <code class="literal">0</code>, the terms must appear next to each other.</p>
</dd>
<dt>
<span class="term">
<code class="literal">ordered</code>
</span>
</dt>
<dd>
(Optional, boolean) If <code class="literal">true</code>, intervals produced by the rules should appear in
the order in which they are specified. Defaults to <code class="literal">false</code>.
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl-intervals-query.html#interval_filter" title="filter rule parameters">interval filter</a> rule object) Rule used to filter
returned intervals.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-any_of"></a><code class="literal">any_of</code> rule parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h3>
</div></div></div>
<p>The <code class="literal">any_of</code> rule returns intervals produced by any of its sub-rules.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">intervals</code>
</span>
</dt>
<dd>
(Required, array of rule objects) An array of rules to match.
</dd>
<dt>
<span class="term">
<code class="literal">filter</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="query-dsl-intervals-query.html#interval_filter" title="filter rule parameters">interval filter</a> rule object) Rule used to filter
returned intervals.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="interval_filter"></a><code class="literal">filter</code> rule parameters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h3>
</div></div></div>
<p>The <code class="literal">filter</code> rule returns intervals based on a query. See
<a class="xref" href="query-dsl-intervals-query.html#interval-filter-rule-ex" title="Filter example">Filter example</a> for an example.</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">after</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that follow an interval
from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">before</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that occur before an
interval from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">contained_by</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals contained by an interval
from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">containing</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that contain an interval
from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">not_contained_by</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that are <span class="strong strong"><strong>not</strong></span>
contained by an interval from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">not_containing</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that do <span class="strong strong"><strong>not</strong></span> contain
an interval from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">not_overlapping</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that do <span class="strong strong"><strong>not</strong></span> overlap
with an interval from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">overlapping</code>
</span>
</dt>
<dd>
(Optional, query object) Query used to return intervals that overlap with an
interval from the <code class="literal">filter</code> rule.
</dd>
<dt>
<span class="term">
<code class="literal">script</code>
</span>
</dt>
<dd>
(Optional, <a class="xref" href="modules-scripting-using.html" title="How to use scripts">script object</a>) Script used to return
matching documents. This script must return a boolean value, <code class="literal">true</code> or <code class="literal">false</code>.
See <a class="xref" href="query-dsl-intervals-query.html#interval-script-filter" title="Script filters">Script filters</a> for an example.
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="intervals-query-note"></a>Notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="interval-filter-rule-ex"></a>Filter example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>The following search includes a <code class="literal">filter</code> rule. It returns documents that have
the words <code class="literal">hot</code> and <code class="literal">porridge</code> within 10 positions of each other, without the
word <code class="literal">salty</code> in between:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "hot porridge",
          "max_gaps" : 10,
          "filter" : {
            "not_containing" : {
              "match" : {
                "query" : "salty"
              }
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/109.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="interval-script-filter"></a>Script filters<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>You can use a script to filter intervals based on their start position, end
position, and internal gap count. The following <code class="literal">filter</code> script uses the
<code class="literal">interval</code> variable with the <code class="literal">start</code>, <code class="literal">end</code>, and <code class="literal">gaps</code> methods:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "hot porridge",
          "filter" : {
            "script" : {
              "source" : "interval.start &gt; 10 &amp;&amp; interval.end &lt; 20 &amp;&amp; interval.gaps == 0"
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/110.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="interval-minimization"></a>Minimization<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/intervals-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>The intervals query always minimizes intervals, to ensure that queries can
run in linear time. This can sometimes cause surprising results, particularly
when using <code class="literal">max_gaps</code> restrictions or filters. For example, take the
following query, searching for <code class="literal">salty</code> contained within the phrase <code class="literal">hot
porridge</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "match" : {
          "query" : "salty",
          "filter" : {
            "contained_by" : {
              "match" : {
                "query" : "hot porridge"
              }
            }
          }
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/111.console"></div>
<p>This query does <span class="strong strong"><strong>not</strong></span> match a document containing the phrase <code class="literal">hot porridge is
salty porridge</code>, because the intervals returned by the match query for <code class="literal">hot
porridge</code> only cover the initial two terms in this document, and these do not
overlap the intervals covering <code class="literal">salty</code>.</p>
<p>Another restriction to be aware of is the case of <code class="literal">any_of</code> rules that contain
sub-rules which overlap. In particular, if one of the rules is a strict
prefix of the other, then the longer rule can never match, which can
cause surprises when used in combination with <code class="literal">max_gaps</code>. Consider the
following query, searching for <code class="literal">the</code> immediately followed by <code class="literal">big</code> or <code class="literal">big bad</code>,
immediately followed by <code class="literal">wolf</code>:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "all_of" : {
          "intervals" : [
            { "match" : { "query" : "the" } },
            { "any_of" : {
                "intervals" : [
                    { "match" : { "query" : "big" } },
                    { "match" : { "query" : "big bad" } }
                ] } },
            { "match" : { "query" : "wolf" } }
          ],
          "max_gaps" : 0,
          "ordered" : true
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/112.console"></div>
<p>Counter-intuitively, this query does <span class="strong strong"><strong>not</strong></span> match the document <code class="literal">the big bad
wolf</code>, because the <code class="literal">any_of</code> rule in the middle only produces intervals
for <code class="literal">big</code> - intervals for <code class="literal">big bad</code> being longer than those for <code class="literal">big</code>, while
starting at the same position, and so being minimized away. In these cases,
it’s better to rewrite the query so that all of the options are explicitly
laid out at the top level:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">POST _search
{
  "query": {
    "intervals" : {
      "my_text" : {
        "any_of" : {
          "intervals" : [
            { "match" : {
                "query" : "the big bad wolf",
                "ordered" : true,
                "max_gaps" : 0 } },
            { "match" : {
                "query" : "the big wolf",
                "ordered" : true,
                "max_gaps" : 0 } }
           ]
        }
      }
    }
  }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/113.console"></div>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="full-text-queries.html">« 全文查询</a>
</span>
<span class="next">
<a href2="query-dsl-match-query.html">Match query »</a>
</span>
</div>
</div>

                  <!-- end body -->
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                        
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</div>
<script src="../static/cn.js"></script>
</body>
</html>