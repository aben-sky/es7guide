<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Match query | ElasticSearch 7.7 权威指南中文版</title>
	<meta name="keywords" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <meta name="description" content="ElasticSearch 权威指南中文版, elasticsearch 7, es7, 实时数据分析，实时数据检索" />
    <!-- Give IE8 a fighting chance -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
	<link rel="stylesheet" type="text/css" href="../static/styles.css" />
	<script>
	var _link = 'query-dsl-match-query.html';
    </script>
</head>
<body>
<div class="main-container">
    <section id="content">
        <div class="content-wrapper">
            <section id="guide" lang="zh_cn">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12 col-sm-8 col-md-8 guide-section">
                            <div style="color:gray; word-break: break-all; font-size:12px;">原英文版地址: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.7/query-dsl-match-query.html" rel="nofollow" target="_blank">https://www.elastic.co/guide/en/elasticsearch/reference/7.7/query-dsl-match-query.html</a>, 原文档版权归 www.elastic.co 所有<br/>本地英文版地址: <a href="../en/query-dsl-match-query.html" rel="nofollow" target="_blank">../en/query-dsl-match-query.html</a></div>
                        <!-- start body -->
                  <div class="page_header">
<strong>重要</strong>: 此版本不会发布额外的bug修复或文档更新。最新信息请参考 <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" rel="nofollow">当前版本文档</a>。
</div>
<div id="content">
<div class="breadcrumbs">
<span class="breadcrumb-link"><a href="index.html">Elasticsearch 权威指南 [7.7]</a></span>
»
<span class="breadcrumb-node"><a href="query-dsl.html">查询 DSL</a></span>
»
<span class="breadcrumb-node"><a href="full-text-queries.html">全文查询</a></span>
»
<span class="breadcrumb-node">match 查询</span>
</div>
<div class="navheader">
<span class="prev">
<a href="query-dsl-intervals-query.html">« intervals 查询</a>
</span>
<span class="next">
<a href2="query-dsl-match-bool-prefix-query.html">Match boolean prefix query »</a>
</span>
</div>
<div class="section">
<div class="titlepage"><div><div>
<h2 class="title">
<a id="query-dsl-match-query"></a>match 查询
</h2>
</div></div></div>

<p>
返回与提供的文本、数字、日期或布尔值相 匹配(match) 的文档。

匹配前会分析提供的文本。
</p>
<p>
<code class="literal">match</code> 查询是执行全文搜索的标准查询，包括一些 模糊(fuzzy) 匹配选项。
</p>
<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="match-query-ex-request"></a>请求示例
</h3>
</div></div></div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : {
                "query" : "this is a test"
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/114.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="match-top-level-params"></a><code class="literal">match</code>的顶级参数
</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">&lt;field&gt;</code>
</span>
</dt>
<dd>
(必填, object) 你想搜索的字段。
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="match-field-params"></a><code class="literal">&lt;field&gt;</code>的参数
</h3>
</div></div></div>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">query</code>
</span>
</dt>
<dd>
<p>(必填) 你希望在提供的 <code class="literal">&lt;field&gt;</code> 中查找的文本(text)、数字(number)、布尔值(bool)或日期(date)。</p>
<p>
<code class="literal">match</code> 查询会在执行搜索前 <a class="xref" href="analysis.html" title="Text analysis">analyzes</a> 任何提供的文本。

这意味着 <code class="literal">match</code> 查询可以在 <a class="xref" href="text.html" title="Text datatype"><code class="literal">text</code></a> 字段中搜索已分析的 词元(token)，而不是精确的 词项(term)。
</p>
</dd>
<dt>
<span class="term">
<code class="literal">analyzer</code>
</span>
</dt>
<dd>
(可选, string) <a class="xref" href="analysis.html" title="Text analysis">analyzer(分析器)</a> 用于将 <code class="literal">query</code> 中的文本转换为 词元(token)。 

默认为映射到<code class="literal">&lt;field&gt;</code>的 <a class="xref" href="specify-analyzer.html#specify-index-time-analyzer" title="How Elasticsearch determines the index analyzer">索引时使用的分析器(index-time analyzer)</a>。

如果没有映射分析器，则使用索引的默认分析器。
</dd>
<dt>
<span class="term">
<code class="literal">auto_generate_synonyms_phrase_query</code>
</span>
</dt>
<dd>
<p>(可选, boolean) 如果为 <code class="literal">true</code>，将自动为 多词项同义词(multi-term synonyms) 创建 <a class="xref" href="query-dsl-match-query-phrase.html" title="Match phrase query">match phrase(短语匹配)</a> 查询。

默认值为 <code class="literal">true</code>。
</p>
<p>
有关示例请参考 <a class="xref" href="query-dsl-match-query.html#query-dsl-match-query-synonyms" title="Synonyms">在match查询中使用同义词</a>。
</p>
</dd>
<dt>
<span class="term">
<code class="literal">fuzziness</code>
</span>
</dt>
<dd>
(可选, string) 匹配时允许的最大编辑距离。

可用的值及更多信息请参考 <a class="xref" href="common-options.html#fuzziness" title="Fuzziness">模糊性(fuzziness)</a>。

有关示例请参考 <a class="xref" href="query-dsl-match-query.html#query-dsl-match-query-fuzziness" title="Fuzziness in the match query">match查询中的模糊性</a>。
</dd>
<dt>
<span class="term">
<code class="literal">max_expansions</code>
</span>
</dt>
<dd>
(可选, integer) 查询可以扩展到的最大 词项(term) 数。默认值为 <code class="literal">50</code>。
</dd>
<dt>
<span class="term">
<code class="literal">prefix_length</code>
</span>
</dt>
<dd>
(可选, integer) 模糊匹配的起始字符保持不变的分数。默认值为 <code class="literal">0</code>。
</dd>
<dt>
<span class="term">
<code class="literal">fuzzy_transpositions</code>
</span>
</dt>
<dd>
(可选, boolean) 如果为 <code class="literal">true</code>，模糊匹配的编辑包括两个相邻字符的交换(ab → ba)。默认值为 <code class="literal">true</code>。
</dd>
<dt>
<span class="term">
<code class="literal">fuzzy_rewrite</code>
</span>
</dt>
<dd>
<p>(可选, string) 用于重写查询的方法。

可用的值及更多信息请参考  <a class="xref" href="query-dsl-multi-term-rewrite.html" title="rewrite parameter"><code class="literal">rewrite</code> 参数</a>。
</p>
<p>
如果参数 <code class="literal">fuzziness</code> 的值不是 <code class="literal">0</code>，默认情况下，<code class="literal">match</code> 查询使用的 <code class="literal">rewrite</code> 方法是 <code class="literal">top_terms_blended_freqs_${max_expansions}</code>。
</p>
</dd>
<dt>
<span class="term">
<code class="literal">lenient</code> 宽容的
</span>
</dt>
<dd>
(可选, boolean) 
如果为 <code class="literal">true</code>，则忽略基于格式的错误，例如为 <a class="xref" href="number.html" title="Numeric datatypes">numeric</a> 字段提供 text 格式的 <code class="literal">query</code> 值。

默认值为 <code class="literal">false</code>。
</dd>
<dt>
<span class="term">
<code class="literal">operator</code>
</span>
</dt>
<dd>
<p>(可选, string) 用于解释 <code class="literal">query</code> 值中文本的布尔逻辑。有效值有：</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">OR</code> (默认值)
</span>
</dt>
<dd>
例如，查询值 <code class="literal">capital of Hungary</code> 被解释为 <code class="literal">capital OR of OR Hungary</code>。
</dd>
<dt>
<span class="term">
<code class="literal">AND</code>
</span>
</dt>
<dd>
例如，查询值 <code class="literal">capital of Hungary</code> 被解释为 <code class="literal">capital AND of AND Hungary</code>。
</dd>
</dl>
</div>
</dd>
<dt>
<span class="term">
<code class="literal">minimum_should_match</code>
</span>
</dt>
<dd>
<p>(可选, string)
要返回的文档必须匹配的最小子句数。

可用的值及更多信息请参考 <a class="xref" href="query-dsl-minimum-should-match.html" title="minimum_should_match parameter"><code class="literal">minimum_should_match</code> 参数</a>。
</p>
</dd>
<dt>
<span class="term">
<code class="literal">zero_terms_query</code>
</span>
</dt>
<dd>
<p>(可选, string)
指示如果 <code class="literal">analyzer</code> 删除所有 词元(token) (例如使用 <code class="literal">stop</code> 过滤器时)，是否不返回任何文档。有效值有：</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
<code class="literal">none</code> (默认值)
</span>
</dt>
<dd>
如果 <code class="literal">analyzer</code> 删除所有 词元(token)，则不返回任何文档。
</dd>
<dt>
<span class="term">
<code class="literal">all</code>
</span>
</dt>
<dd>
返回所有文档, 与 <a class="xref" href="query-dsl-match-all-query.html" title="Match all query"><code class="literal">match_all</code></a> 查询类似。
</dd>
</dl>
</div>
<p>See <a class="xref" href="query-dsl-match-query.html#query-dsl-match-query-zero" title="Zero terms query">Zero terms query</a> for an example.</p>
</dd>
</dl>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h3 class="title">
<a id="match-query-notes"></a>Notes<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h3>
</div></div></div>
<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-short-ex"></a>Short request example<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>You can simplify the match query syntax by combining the <code class="literal">&lt;field&gt;</code> and <code class="literal">query</code>
parameters. For example:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : "this is a test"
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/115.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-boolean"></a>How the match query works<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>The <code class="literal">match</code> query is of type <code class="literal">boolean</code>. It means that the text
provided is analyzed and the analysis process constructs a boolean query
from the provided text. The <code class="literal">operator</code> parameter can be set to <code class="literal">or</code> or <code class="literal">and</code>
to control the boolean clauses (defaults to <code class="literal">or</code>). The minimum number of
optional <code class="literal">should</code> clauses to match can be set using the
<a class="xref" href="query-dsl-minimum-should-match.html" title="minimum_should_match parameter"><code class="literal">minimum_should_match</code></a>
parameter.</p>
<p>Here is an example with the <code class="literal">operator</code> parameter:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : {
                "query" : "this is a test",
                "operator" : "and"
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/116.console"></div>
<p>The <code class="literal">analyzer</code> can be set to control which analyzer will perform the
analysis process on the text. It defaults to the field explicit mapping
definition, or the default search analyzer.</p>
<p>The <code class="literal">lenient</code> parameter can be set to <code class="literal">true</code> to ignore exceptions caused by
data-type mismatches,  such as trying to query a numeric field with a text
query string. Defaults to <code class="literal">false</code>.</p>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-fuzziness"></a>Fuzziness in the match query<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p><code class="literal">fuzziness</code> allows <em>fuzzy matching</em> based on the type of field being queried.
See <a class="xref" href="common-options.html#fuzziness" title="Fuzziness">Fuzziness</a> for allowed settings.</p>
<p>The <code class="literal">prefix_length</code> and
<code class="literal">max_expansions</code> can be set in this case to control the fuzzy process.
If the fuzzy option is set the query will use <code class="literal">top_terms_blended_freqs_${max_expansions}</code>
as its <a class="xref" href="query-dsl-multi-term-rewrite.html" title="rewrite parameter">rewrite
method</a> the <code class="literal">fuzzy_rewrite</code> parameter allows to control how the query will get
rewritten.</p>
<p>Fuzzy transpositions (<code class="literal">ab</code> → <code class="literal">ba</code>) are allowed by default but can be disabled
by setting <code class="literal">fuzzy_transpositions</code> to <code class="literal">false</code>.</p>
<div class="note admon">
<div class="icon"></div>
<div class="admon_content">
<p>Fuzzy matching is not applied to terms with synonyms or in cases where the
analysis process produces multiple tokens at the same position. Under the hood
these terms are expanded to a special synonym query that blends term frequencies,
which does not support fuzzy expansion.</p>
</div>
</div>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : {
                "query" : "this is a testt",
                "fuzziness": "AUTO"
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/117.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-zero"></a>Zero terms query<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>If the analyzer used removes all tokens in a query like a <code class="literal">stop</code> filter
does, the default behavior is to match no documents at all. In order to
change that the <code class="literal">zero_terms_query</code> option can be used, which accepts
<code class="literal">none</code> (default) and <code class="literal">all</code> which corresponds to a <code class="literal">match_all</code> query.</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : {
                "query" : "to be or not to be",
                "operator" : "and",
                "zero_terms_query": "all"
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/118.console"></div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-cutoff"></a>Cutoff frequency<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<div class="warning admon">
<div class="icon"></div>
<div class="admon_content">
<h3>Deprecated in 7.3.0.</h3>
<p>This option can be omitted as the <a class="xref" href="query-dsl-match-query.html" title="Match query">Match</a> can skip blocks of documents efficiently, without any configuration, provided that the total number of hits is not tracked.</p>
</div>
</div>
<p>The match query supports a <code class="literal">cutoff_frequency</code> that allows
specifying an absolute or relative document frequency where high
frequency terms are moved into an optional subquery and are only scored
if one of the low frequency (below the cutoff) terms in the case of an
<code class="literal">or</code> operator or all of the low frequency terms in the case of an <code class="literal">and</code>
operator match.</p>
<p>This query allows handling <code class="literal">stopwords</code> dynamically at runtime, is domain
independent and doesn’t require a stopword file. It prevents scoring /
iterating high frequency terms and only takes the terms into account if a
more significant / lower frequency term matches a document. Yet, if all
of the query terms are above the given <code class="literal">cutoff_frequency</code> the query is
automatically transformed into a pure conjunction (<code class="literal">and</code>) query to
ensure fast execution.</p>
<p>The <code class="literal">cutoff_frequency</code> can either be relative to the total number of
documents if in the range from 0 (inclusive) to 1 (exclusive) or absolute if greater or equal to
<code class="literal">1.0</code>.</p>
<p>Here is an example showing a query composed of stopwords exclusively:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
    "query": {
        "match" : {
            "message" : {
                "query" : "to be or not to be",
                "cutoff_frequency" : 0.001
            }
        }
    }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/119.console"></div>
<div class="important admon">
<div class="icon"></div>
<div class="admon_content">
<p>The <code class="literal">cutoff_frequency</code> option operates on a per-shard-level. This means
that when trying it out on test indexes with low document numbers you
should follow the advice in <a href="https://www.elastic.co/guide/en/elasticsearch/guide/2.x/relevance-is-broken.html" class="ulink" target="_top">Relevance is broken</a>.</p>
</div>
</div>
</div>

<div class="section">
<div class="titlepage"><div><div>
<h4 class="title">
<a id="query-dsl-match-query-synonyms"></a>Synonyms<a class="edit_me edit_me_private" rel="nofollow" title="Editing on GitHub is available to Elastic" href="https://github.com/elastic/elasticsearch/edit/7.7/docs/reference/query-dsl/match-query.asciidoc">edit</a>
</h4>
</div></div></div>
<p>The <code class="literal">match</code> query supports multi-terms synonym expansion with the <a class="xref" href="analysis-synonym-graph-tokenfilter.html" title="Synonym graph token filter">synonym_graph</a> token filter. When this filter is used, the parser creates a phrase query for each multi-terms synonyms.
For example, the following synonym: <code class="literal">"ny, new york"</code> would produce:</p>
<p><code class="literal">(ny OR ("new york"))</code></p>
<p>It is also possible to match multi terms synonyms with conjunctions instead:</p>
<div class="pre_wrapper lang-console">
<pre class="programlisting prettyprint lang-console">GET /_search
{
   "query": {
       "match" : {
           "message": {
               "query" : "ny city",
               "auto_generate_synonyms_phrase_query" : false
           }
       }
   }
}</pre>
</div>
<div class="console_widget" data-snippet="snippets/120.console"></div>
<p>The example above creates a boolean query:</p>
<p><code class="literal">(ny OR (new AND york)) city</code></p>
<p>that matches documents with the term <code class="literal">ny</code> or the conjunction <code class="literal">new AND york</code>.
By default the parameter <code class="literal">auto_generate_synonyms_phrase_query</code> is set to <code class="literal">true</code>.</p>
</div>

</div>

</div>
<div class="navfooter">
<span class="prev">
<a href="query-dsl-intervals-query.html">« intervals 查询</a>
</span>
<span class="next">
<a href2="query-dsl-match-bool-prefix-query.html">Match boolean prefix query »</a>
</span>
</div>
</div>

                  <!-- end body -->
                        </div>
                        <div class="col-xs-12 col-sm-4 col-md-4" id="right_col">
                        
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </section>
</div>
<script src="../static/cn.js"></script>
</body>
</html>